[gcode_macro START_PRINT]
gcode:
    # 1. Clear any previous bed mesh and set absolute positioning
    BED_MESH_CLEAR
    G90
    M83 ; Extruder relative mode
    
    # 2. Get temperatures from your slicer (Matches HOTEND variable)
    {% set BED_TEMP = params.BED|default(60)|float %}
    {% set EXTRUDER_TEMP = params.HOTEND|default(200)|float %}
    {% set CHAMBER_TEMP = params.CHAMBER|default(0)|float %}

    # 3. Start heating the Bed and the Enclosure immediately
    M117 Preheating Bed & Chamber...
    M140 S{BED_TEMP}
    SET_HEATER_TEMPERATURE HEATER=enclosure TARGET={CHAMBER_TEMP}
    
    # 4. Home the printer while it's heating
    G28

    # 5. WAIT for Bed and Chamber to reach targets
    M190 S{BED_TEMP}
    
    {% if CHAMBER_TEMP > 0 %}
        M117 Waiting for Chamber: {CHAMBER_TEMP}C
        # Reference the specific generic heater sensor defined in printer.cfg
        TEMPERATURE_WAIT SENSOR="heater_generic enclosure" MINIMUM={CHAMBER_TEMP}
    {% endif %}

    # 6. Heat the nozzle once the chamber is ready
    M117 Heating Nozzle...
    M109 S{EXTRUDER_TEMP}
    
    # 7. Load your saved bed mesh
    BED_MESH_PROFILE LOAD=default
    
    # 8. PRIME LINE (Optimized from your source code)
    M117 Purging...
    G92 E0                   ; Reset Extruder
    G1 Z2.0 F3000            ; Move Z Up
    G1 X10 Y10 F6000         ; Move to start
    G1 Z0.3                  ; Lower Z
    G1 X10 Y150 F1500 E15    ; Draw first line
    G1 X10.5 F6000           ; Wipe sideways
    G1 X